<?phpclass SubWechat{    //公众号的信息    private $wx = array();    //微信推送过来的数据    private $data = array();    public function __construct($token,$appid,$appsecret)    {	    $this->wx['token'] = $token;        $this->wx['appid'] = $appid;        $this->wx['appsecret'] = $appsecret;        if (IS_GET) {            die;        }        else        {            $xml = file_get_contents('php://input');            $xml = new SimpleXMLElement($xml);            $xml || die;            foreach ($xml as $key => $value) {                $this->data[$key] = strval($value);            }        }    }    public function request()    {        return $this->data;    }    public function response($content, $type = 'text', $flag = 0)    {	    if($type=='no'){		    echo '';		    exit();	    }        $this->data = array('ToUserName' => $this->data['FromUserName'], 'FromUserName' => $this->data['ToUserName'], 'CreateTime' => NOW_TIME, 'MsgType' => $type);        if($type!='transfer_customer_service')        {            $this->{$type}($content);            $this->data['FuncFlag'] = $flag;         }        $xml = new SimpleXMLElement('<xml></xml>');               $this->data2xml($xml, $this->data);				$content = "\r\n".$xml->asXML();        $log_file=date("YmdH",time());        $log_file="C-".$log_file.".log";        $root = $_SERVER["DOCUMENT_ROOT"];        $fp = fopen("$root/gdwx_log/$log_file",'ab');        fwrite($fp,$content);        fclose($fp);        die($xml->asXML());    }    private function text($content)    {        $this->data['Content'] = $content;    }    private function music($music)    {        list($music['Title'], $music['Description'], $music['MusicUrl'], $music['HQMusicUrl']) = $music;        $this->data['Music'] = $music;    }    private function news($news)    {        $articles = array();        foreach ($news as $key => $value) {            list($articles[$key]['Title'], $articles[$key]['Description'], $articles[$key]['PicUrl'], $articles[$key]['Url']) = $value;            if ($key >= 9) {                break;            }        }        $this->data['ArticleCount'] = count($articles);        $this->data['Articles'] = $articles;    }    private function data2xml($xml, $data, $item = 'item')    {        foreach ($data as $key => $value) {            is_numeric($key) && ($key = $item);            if (is_array($value) || is_object($value)) {                $child = $xml->addChild($key);                $this->data2xml($child, $value, $item);            }            else            {                if (is_numeric($value))                {                    $child = $xml->addChild($key, $value);                }                else                {                    $child = $xml->addChild($key);                    $node = dom_import_simplexml($child);                    $node->appendChild($node->ownerDocument->createCDATASection($value));                }            }        }    }}?>